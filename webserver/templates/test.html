<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama API Test</title>
</head>
<body>
    <h2>Test Ollama API</h2>
    <textarea id="prompt" rows="4" cols="50" placeholder="Enter a prompt..."></textarea><br>
    <button onclick="sendRequest()">Generate</button>
    <h3>Response:</h3>
    <pre id="response"></pre>

    <script>
        async function sendRequest() {
            const prompt = document.getElementById("prompt").value;
            const responseElement = document.getElementById("response");
            responseElement.innerText = ""; // Clear previous response
    
            try {
                const response = await fetch("http://localhost:5000/generate", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ prompt: prompt })
                });
    
                if (!response.body) {
                    responseElement.innerText = "Error: No response body";
                    return;
                }
    
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let partialData = ""; // Buffer to store incomplete JSON
    
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
    
                    const chunk = decoder.decode(value, { stream: true });
                    console.log("Received chunk:", chunk);
    
                    partialData += chunk; // Append new data to the buffer
    
                    // Process each complete JSON line separately
                    const lines = partialData.split("\n");
    
                    for (let i = 0; i < lines.length - 1; i++) { // Process all except the last (incomplete) line
                        if (lines[i].startsWith("data: ")) {
                            try {
                                const jsonData = JSON.parse(lines[i].substring(6)); // Remove "data: "
                                responseElement.innerText += jsonData.response || "";
                            } catch (error) {
                                console.error("Error parsing JSON:", error);
                            }
                        }
                    }
    
                    // Keep only the last part (possibly incomplete JSON)
                    partialData = lines[lines.length - 1];
                }
            } catch (error) {
                responseElement.innerText = "Error: " + error;
            }
        }
    </script>
</body>
</html>

